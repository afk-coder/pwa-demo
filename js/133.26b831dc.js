"use strict";(self["webpackChunksl_device_vue"]=self["webpackChunksl_device_vue"]||[]).push([[133],{133:function(t,e,i){i.r(e),i.d(e,{default:function(){return r}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"app-container"},[e("van-form",{on:{submit:t.onSubmit}},[e("van-field",{attrs:{label:"工单名称",readonly:""},model:{value:t.ticket.name,callback:function(e){t.$set(t.ticket,"name",e)},expression:"ticket.name"}}),e("van-field",{attrs:{label:"工单来源",readonly:""},model:{value:t.ticket.source_show,callback:function(e){t.$set(t.ticket,"source_show",e)},expression:"ticket.source_show"}}),e("van-field",{attrs:{label:"工单状态",readonly:""},scopedSlots:t._u([{key:"input",fn:function(){return[e("van-tag",{attrs:{type:"primary"}},[t._v(t._s(t._f("stateFilter")(t.ticket.state)))])]},proxy:!0}]),model:{value:t.ticket.state,callback:function(e){t.$set(t.ticket,"state",e)},expression:"ticket.state"}}),e("van-field",{attrs:{rows:"3",autosize:"",label:"保洁说明",type:"textarea",maxlength:"200","show-word-limit":"",readonly:""},model:{value:t.ticket.note,callback:function(e){t.$set(t.ticket,"note",e)},expression:"ticket.note"}}),e("van-uploader",{attrs:{multiple:"","max-count":5,"max-size":1048576,deletable:!1,"show-upload":!1},model:{value:t.noteFileList,callback:function(e){t.noteFileList=e},expression:"noteFileList"}}),t.ticket.audio?e("div",[e("van-cell",{attrs:{title:"语音播放",value:""}}),e("audio",{ref:"audioPlayer",attrs:{src:t.ticket.audio,controls:""}})],1):t._e(),e("van-cell",{attrs:{title:t.isReadonly?"图片列表":"上传图片",value:""}}),e("van-uploader",{staticStyle:{float:"left"},attrs:{multiple:"","max-count":5,"after-read":t.afterRead,"max-size":1048576,deletable:!t.isReadonly,"show-upload":!1},on:{oversize:t.onOversize},model:{value:t.fileList,callback:function(e){t.fileList=e},expression:"fileList"}}),t.isReadonly?t._e():e("div",{staticClass:"van-uploader__upload van-uploader__upload--readonly",staticStyle:{float:"left"},on:{click:function(e){return t.chooseImage({val:0})}}},[e("i",{staticClass:"van-icon van-icon-photograph van-uploader__upload-icon"})]),t.isReadonly?t._e():e("div",{staticStyle:{margin:"30px"}},[e("van-button",{attrs:{round:"",block:"",type:"info",icon:"checked","native-type":"submit"}},[t._v("完成工单")])],1)],1)],1)},a=[],l=(i(4114),{name:"CleanTicketInfo",filters:{stateFilter(t){const e={0:"未开始",1:"进行中",10:"已完成",20:"已过期"};return e[t]}},data(){return{ticket_id:"",operate:"",ticket:{},noteFileList:[],fileList:[],isReadonly:!1}},async mounted(){if(this.ticket_id=this.$route.query.ticket_id,this.operate=this.$route.query.operate,this.ticket=await this.$http.post("/clean-ticket/get",{ticket_id:this.ticket_id}),this.isReadonly="view"===this.operate||10===this.ticket.state||20===this.ticket.state,this.ticket.source_show=this.sourceFilter(this.ticket.source),this.ticket.note_imagelist&&this.ticket.note_imagelist.length>0){const t=[];this.ticket.note_imagelist.forEach((e=>{t.push({url:e,isImage:!0})})),this.noteFileList=t}if(this.ticket.imagelist&&this.ticket.imagelist.length>0){const t=[];this.ticket.imagelist.forEach((e=>{t.push({url:e,isImage:!0})})),this.fileList=t}},methods:{sourceFilter(t){const e={1:"客户发起",2:"系统自动发起",3:"服务点发起"};return e[t]},afterRead(t){},onOversize(t){this.$toast("文件大小不能超过 1024kb")},chooseImage(t){this.show=!1,this.$bridge.CollectPhoto(t.val).then((t=>{if(t){const e="data:image/png;base64,"+t;this.fileList.push({content:e,url:e,isImage:!0})}else this.$toast("未选择图片")}))},async onSubmit(){const t=[];if(this.fileList&&this.fileList.length>0&&this.fileList.map((e=>{e&&e.content&&t.push(e.content.substring(e.content.indexOf(",")+1))})),!(t&&t.length>0))return void this.$toast("请至少上传一张图片");let e=await this.$dialog.confirm({title:"标题",message:"是否确认保存？"}).catch((()=>{}));e&&(await this.$http.post("/clean-ticket/complete",{ticket_id:this.ticket_id,file_list:t}),e=await this.$dialog.alert({message:"操作成功！"}),e&&await this.$bridge.Close(!0))}}}),o=l,n=i(845),c=(0,n.A)(o,s,a,!1,null,"424228a4",null),r=c.exports}}]);
//# sourceMappingURL=133.26b831dc.js.map