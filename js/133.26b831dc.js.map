{"version":3,"file":"js/133.26b831dc.js","mappings":"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","sources":["webpack://sl-device-vue/./src/views/ticket/clean/info.vue","webpack://sl-device-vue/src/views/ticket/clean/info.vue","webpack://sl-device-vue/./src/views/ticket/clean/info.vue?182a","webpack://sl-device-vue/./src/views/ticket/clean/info.vue?3bb8"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"app-container\"},[_c('van-form',{on:{\"submit\":_vm.onSubmit}},[_c('van-field',{attrs:{\"label\":\"工单名称\",\"readonly\":\"\"},model:{value:(_vm.ticket.name),callback:function ($$v) {_vm.$set(_vm.ticket, \"name\", $$v)},expression:\"ticket.name\"}}),_c('van-field',{attrs:{\"label\":\"工单来源\",\"readonly\":\"\"},model:{value:(_vm.ticket.source_show),callback:function ($$v) {_vm.$set(_vm.ticket, \"source_show\", $$v)},expression:\"ticket.source_show\"}}),_c('van-field',{attrs:{\"label\":\"工单状态\",\"readonly\":\"\"},scopedSlots:_vm._u([{key:\"input\",fn:function(){return [_c('van-tag',{attrs:{\"type\":\"primary\"}},[_vm._v(_vm._s(_vm._f(\"stateFilter\")(_vm.ticket.state)))])]},proxy:true}]),model:{value:(_vm.ticket.state),callback:function ($$v) {_vm.$set(_vm.ticket, \"state\", $$v)},expression:\"ticket.state\"}}),_c('van-field',{attrs:{\"rows\":\"3\",\"autosize\":\"\",\"label\":\"保洁说明\",\"type\":\"textarea\",\"maxlength\":\"200\",\"show-word-limit\":\"\",\"readonly\":\"\"},model:{value:(_vm.ticket.note),callback:function ($$v) {_vm.$set(_vm.ticket, \"note\", $$v)},expression:\"ticket.note\"}}),_c('van-uploader',{attrs:{\"multiple\":\"\",\"max-count\":5,\"max-size\":1024 * 1024,\"deletable\":false,\"show-upload\":false},model:{value:(_vm.noteFileList),callback:function ($$v) {_vm.noteFileList=$$v},expression:\"noteFileList\"}}),(_vm.ticket.audio)?_c('div',[_c('van-cell',{attrs:{\"title\":\"语音播放\",\"value\":\"\"}}),_c('audio',{ref:\"audioPlayer\",attrs:{\"src\":_vm.ticket.audio,\"controls\":\"\"}})],1):_vm._e(),_c('van-cell',{attrs:{\"title\":_vm.isReadonly?'图片列表':'上传图片',\"value\":\"\"}}),_c('van-uploader',{staticStyle:{\"float\":\"left\"},attrs:{\"multiple\":\"\",\"max-count\":5,\"after-read\":_vm.afterRead,\"max-size\":1024 * 1024,\"deletable\":!_vm.isReadonly,\"show-upload\":false},on:{\"oversize\":_vm.onOversize},model:{value:(_vm.fileList),callback:function ($$v) {_vm.fileList=$$v},expression:\"fileList\"}}),(!_vm.isReadonly)?_c('div',{staticClass:\"van-uploader__upload van-uploader__upload--readonly\",staticStyle:{\"float\":\"left\"},on:{\"click\":function($event){return _vm.chooseImage({val:0})}}},[_c('i',{staticClass:\"van-icon van-icon-photograph van-uploader__upload-icon\"})]):_vm._e(),(!_vm.isReadonly)?_c('div',{staticStyle:{\"margin\":\"30px\"}},[_c('van-button',{attrs:{\"round\":\"\",\"block\":\"\",\"type\":\"info\",\"icon\":\"checked\",\"native-type\":\"submit\"}},[_vm._v(\"完成工单\")])],1):_vm._e()],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"app-container\">\r\n    <van-form @submit=\"onSubmit\">\r\n      <van-field v-model=\"ticket.name\" label=\"工单名称\" readonly />\r\n      <van-field v-model=\"ticket.source_show\" label=\"工单来源\" readonly />\r\n      <van-field v-model=\"ticket.state\" label=\"工单状态\" readonly>\r\n        <template #input>\r\n          <van-tag type=\"primary\">{{ ticket.state | stateFilter }}</van-tag>\r\n        </template>\r\n      </van-field>\r\n      <van-field\r\n        v-model=\"ticket.note\"\r\n        rows=\"3\"\r\n        autosize\r\n        label=\"保洁说明\"\r\n        type=\"textarea\"\r\n        maxlength=\"200\"\r\n        show-word-limit\r\n        readonly\r\n      />\r\n      <van-uploader v-model=\"noteFileList\" multiple :max-count=\"5\" :max-size=\"1024 * 1024\" :deletable=\"false\" :show-upload=\"false\" />\r\n      <div v-if=\"ticket.audio\">\r\n        <van-cell title=\"语音播放\" value=\"\" />\r\n        <audio ref=\"audioPlayer\" :src=\"ticket.audio\" controls />\r\n      </div>\r\n      <van-cell :title=\"isReadonly?'图片列表':'上传图片'\" value=\"\" />\r\n      <!--电脑选择图片-->\r\n      <!--      <van-uploader v-model=\"fileList\" multiple :max-count=\"5\" :after-read=\"afterRead\" :max-size=\"1024 * 1024\" :deletable=\"!isReadonly\" :show-upload=\"!isReadonly\" style=\"float: left;\" @oversize=\"onOversize\" />-->\r\n\r\n      <!--真机拍照-->\r\n      <van-uploader v-model=\"fileList\" multiple :max-count=\"5\" :after-read=\"afterRead\" :max-size=\"1024 * 1024\" :deletable=\"!isReadonly\" :show-upload=\"false\" style=\"float: left;\" @oversize=\"onOversize\" />\r\n      <div v-if=\"!isReadonly\" class=\"van-uploader__upload van-uploader__upload--readonly\" style=\"float:left;\" @click=\"chooseImage({val:0})\">\r\n        <i class=\"van-icon van-icon-photograph van-uploader__upload-icon\" />\r\n      </div>\r\n      <div v-if=\"!isReadonly\" style=\"margin: 30px;\">\r\n        <van-button round block type=\"info\" icon=\"checked\" native-type=\"submit\">完成工单</van-button>\r\n      </div>\r\n    </van-form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'CleanTicketInfo',\r\n  filters: {\r\n    stateFilter(val) {\r\n      const map = {\r\n        0: '未开始',\r\n        1: '进行中',\r\n        10: '已完成',\r\n        20: '已过期'\r\n      }\r\n      return map[val]\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      ticket_id: '',\r\n      operate: '', // 操作类型：view查看\r\n      ticket: {},\r\n      noteFileList: [], // 保洁说明图片\r\n      fileList: [],\r\n      isReadonly: false // 是否只读\r\n    }\r\n  },\r\n  async mounted() {\r\n    this.ticket_id = this.$route.query.ticket_id\r\n    this.operate = this.$route.query.operate\r\n    this.ticket = await this.$http.post('/clean-ticket/get', { ticket_id: this.ticket_id })\r\n    this.isReadonly = this.operate === 'view' || this.ticket.state === 10 || this.ticket.state === 20// 已完成或者已过期\r\n    this.ticket.source_show = this.sourceFilter(this.ticket.source)\r\n    if (this.ticket.note_imagelist && this.ticket.note_imagelist.length > 0) {\r\n      const noteImageArr = []\r\n      this.ticket.note_imagelist.forEach(item => {\r\n        noteImageArr.push({ url: item, isImage: true })\r\n      })\r\n      this.noteFileList = noteImageArr\r\n    }\r\n    if (this.ticket.imagelist && this.ticket.imagelist.length > 0) {\r\n      const imageArr = []\r\n      this.ticket.imagelist.forEach(item => {\r\n        imageArr.push({ url: item, isImage: true })\r\n      })\r\n      this.fileList = imageArr\r\n    }\r\n  },\r\n  methods: {\r\n    sourceFilter(val) {\r\n      const map = {\r\n        '1': '客户发起',\r\n        '2': '系统自动发起',\r\n        '3': '服务点发起'\r\n      }\r\n      return map[val]\r\n    },\r\n    afterRead(file) {\r\n      // 此时可以自行将文件上传至服务器\r\n    },\r\n    onOversize(file) {\r\n      this.$toast('文件大小不能超过 1024kb')\r\n    },\r\n    chooseImage(item) {\r\n      // 默认情况下点击选项时不会自动收起\r\n      // 可以通过 close-on-click-action 属性开启自动收起\r\n      this.show = false\r\n      this.$bridge.CollectPhoto(item.val).then(res => {\r\n        if (!res) {\r\n          this.$toast('未选择图片')\r\n        } else {\r\n          const base64 = 'data:image/png;base64,' + res\r\n          this.fileList.push({ content: base64, url: base64, isImage: true })\r\n        }\r\n      })\r\n    },\r\n    async onSubmit() {\r\n      // if (!(this.point + '')) {\r\n      //   this.$toast('分数不能为空')\r\n      //   return\r\n      // }\r\n      // if (!this.note) {\r\n      //   this.$toast('质控报告不能为空')\r\n      //   return\r\n      // }\r\n      const fileArr = []\r\n      if (this.fileList && this.fileList.length > 0) {\r\n        // eslint-disable-next-line array-callback-return\r\n        this.fileList.map(item => {\r\n          if (item && item.content) {\r\n            fileArr.push(item.content.substring(item.content.indexOf(',') + 1))\r\n          }\r\n        })\r\n      }\r\n      if (!(fileArr && fileArr.length > 0)) {\r\n        this.$toast('请至少上传一张图片')\r\n        return\r\n      }\r\n\r\n      let confirm = await this.$dialog.confirm({\r\n        title: '标题',\r\n        message: '是否确认保存？'\r\n      }).catch(() => {})\r\n      if (!confirm) return\r\n\r\n      await this.$http.post('/clean-ticket/complete', { ticket_id: this.ticket_id, file_list: fileArr })\r\n\r\n      confirm = await this.$dialog.alert({ message: '操作成功！' })\r\n      if (!confirm) return\r\n      // this.$router.back()\r\n      await this.$bridge.Close(true)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.app-container {\r\n  width: 100%;\r\n  height: 100%;\r\n  overflow: auto;\r\n  background-color: #fff;\r\n  color: rgb(153, 153, 153);\r\n  p {\r\n    margin: 0 0 5px 0;\r\n  }\r\n  .row{\r\n    display: flex;\r\n    justify-content: space-between;\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./info.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./info.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./info.vue?vue&type=template&id=424228a4&scoped=true\"\nimport script from \"./info.vue?vue&type=script&lang=js\"\nexport * from \"./info.vue?vue&type=script&lang=js\"\nimport style0 from \"./info.vue?vue&type=style&index=0&id=424228a4&prod&lang=less&scoped=true\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"424228a4\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","on","onSubmit","attrs","model","value","ticket","name","callback","$$v","$set","expression","source_show","scopedSlots","_u","key","fn","_v","_s","_f","state","proxy","note","noteFileList","audio","ref","_e","isReadonly","staticStyle","afterRead","onOversize","fileList","$event","chooseImage","val","staticRenderFns","filters","stateFilter","map","data","ticket_id","operate","mounted","$route","query","$http","post","sourceFilter","source","note_imagelist","length","noteImageArr","forEach","item","push","url","isImage","imagelist","imageArr","methods","file","$toast","show","$bridge","CollectPhoto","then","res","base64","content","fileArr","substring","indexOf","confirm","$dialog","title","message","catch","file_list","alert","Close","component"],"sourceRoot":""}