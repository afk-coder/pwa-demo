"use strict";(self["webpackChunksl_device_vue"]=self["webpackChunksl_device_vue"]||[]).push([[644],{2136:function(t,e,i){i.d(e,{A:function(){return h}});var a=function(){var t=this,e=t._self._c;return e("div",[e("van-uploader",{attrs:{accept:t.accept,name:t.name,"max-count":t.maxCount,capture:t.capture,"before-delete":t.beforeDelete},on:{"click-upload":function(e){return e.preventDefault(),t.clickUpload.apply(null,arguments)}},model:{value:t.fileList,callback:function(e){t.fileList=e},expression:"fileList"}}),e("custom-photo",{ref:"uploader",attrs:{accept:t.accept,name:t.name,"max-count":t.maxCount,capture:t.capture},on:{onPhoto:t.onPhoto}})],1)},s=[],o=(i(4114),function(){var t=this,e=t._self._c;return e("div",[e("van-uploader",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"uploader",attrs:{accept:t.accept,name:t.name,"max-count":t.maxCount,capture:t.capture,"before-read":t.beforeRead,"after-read":t.afterRead}})],1)}),n=[],r={name:"CustomPhoto",props:{name:{type:String,require:!0},accept:{type:String,require:!0},maxCount:{type:String,require:!0,default(){return"3"}},capture:{type:String,require:!1}},data(){return{fileType:{attachs:["application/vnd.ms-excel","application/msword","application/pdf","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],image:["image/jpeg","image/png","image/jpg"],audio:[]}}},mounted(){},methods:{beforeRead(t,e){const i=this.fileType[e.name].indexOf(t.type)>=0;return!!i||(this.$toast("文件上传格式错误"),!1)},afterRead(t){this.$emit("onPhoto",t)},take(){this.$nextTick((()=>{this.$refs.uploader.chooseFile()}))}}},l=r,c=i(845),d=(0,c.A)(l,o,n,!1,null,"91ed2b4a",null),u=d.exports,p={name:"CustomFileUpload",components:{CustomPhoto:u},props:{name:{type:String,require:!0},accept:{type:String,require:!0},maxCount:{type:String,require:!0,default(){return"3"}},capture:{type:String,require:!1}},data(){return{fileList:[]}},created(){},mounted(){this.$on("input",(t=>{console.log(t),this.fileList=t}))},methods:{beforeDelete(t){this.fileList.splice(t,1),this.$emit("input",this.fileList)},onPhoto(t){const e=new FormData;e.append("file",t.file),this.$postFile("/upload/file",e).then((t=>{this.fileList.push({url:this.$api.baseImage+t,isImage:!0}),this.$emit("input",this.fileList)})).catch((()=>{}))},clickUpload(t){t.preventDefault(),console.log(this.$utils.isPwa()),this.$utils.isPwa()?this.$refs.uploader.take():this.$bridge.CollectPhoto(0).then((t=>{t?this.$post("/upload/image",{base64:t}).then((t=>{this.fileList.push({url:this.$api.baseImage+t,isImage:!0}),this.$emit("input",this.fileList)})).catch((()=>{})):this.$toast("未选择图片")}))}}},m=p,f=(0,c.A)(m,a,s,!1,null,"0cab2d65",null),h=f.exports},8644:function(t,e,i){i.r(e),i.d(e,{default:function(){return d}});var a=function(){var t=this,e=t._self._c;return e("div",[e("van-form",{attrs:{"show-error-message":!1},on:{submit:t.onSubmit,failed:t.validFailed}},[t._l(t.list,(function(i,a){return e("div",{key:a},[e("van-cell",{attrs:{title:i.name,border:!1}}),"text"===i.options_id?e("div",[e("van-field",{attrs:{name:t.ticketData[i.id],required:"T"===i.not_skip_flag,placeholder:"请输入",rules:[{required:"T"===i.not_skip_flag,message:"请输入"}]},model:{value:t.ticketData[i.id],callback:function(e){t.$set(t.ticketData,i.id,e)},expression:"ticketData[item.id]"}})],1):t._e(),"number"===i.options_id?e("div",[e("van-field",{attrs:{name:t.ticketData[i.id],required:"T"===i.not_skip_flag,type:"number",placeholder:"请输入",rules:[{required:"T"===i.not_skip_flag,message:"请输入"}]},model:{value:t.ticketData[i.id],callback:function(e){t.$set(t.ticketData,i.id,e)},expression:"ticketData[item.id]"}})],1):t._e(),"radio"===i.options_id?e("div",[e("van-field",{attrs:{name:t.ticketData[i.id],required:"T"===i.not_skip_flag,rules:[{required:"T"===i.not_skip_flag,message:"请选择"}]},scopedSlots:t._u([{key:"input",fn:function(){return[e("van-radio-group",{attrs:{direction:"horizontal"},model:{value:t.ticketData[i.id],callback:function(e){t.$set(t.ticketData,i.id,e)},expression:"ticketData[item.id]"}},t._l(i.list_options,(function(i,a){return e("van-radio",{key:a,attrs:{name:i.value}},[t._v(t._s(i.label))])})),1)]},proxy:!0}],null,!0)})],1):t._e(),"checkbox"===i.options_id?e("div",[e("van-field",{attrs:{name:"checkbox_"+i.id,required:"T"===i.not_skip_flag,rules:[{required:"T"===i.not_skip_flag,message:"请选择"}]},scopedSlots:t._u([{key:"input",fn:function(){return[e("van-checkbox-group",{attrs:{direction:"horizontal"},model:{value:t.ticketData[i.id],callback:function(e){t.$set(t.ticketData,i.id,e)},expression:"ticketData[item.id]"}},t._l(i.list_options,(function(i,a){return e("van-checkbox",{key:a,attrs:{name:i.value,shape:"square"}},[t._v(t._s(i.label))])})),1)]},proxy:!0}],null,!0)})],1):t._e(),"image"===i.options_id?e("div",[e("van-field",{attrs:{name:"imageUploader"+i.id,required:"T"===i.not_skip_flag,rules:[{required:"T"===i.not_skip_flag,message:"请上传"}]},scopedSlots:t._u([{key:"input",fn:function(){return[e("custom-file-upload",{attrs:{capture:"camera",name:"image"},model:{value:t.ticketData[i.id],callback:function(e){t.$set(t.ticketData,i.id,e)},expression:"ticketData[item.id]"}})]},proxy:!0}],null,!0)})],1):t._e(),"attachs"===i.options_id?e("div",[e("van-field",{attrs:{name:"attachsUploader"+i.id,required:"T"===i.not_skip_flag,rules:[{required:"T"===i.not_skip_flag,message:"请上传"}]},scopedSlots:t._u([{key:"input",fn:function(){return[e("custom-file-upload",{attrs:{accept:".doc, .docx, .pdf, .xls, .xlsx",name:"attachs"},model:{value:t.ticketData[i.id],callback:function(e){t.$set(t.ticketData,i.id,e)},expression:"ticketData[item.id]"}})]},proxy:!0}],null,!0)})],1):t._e(),"audio"===i.options_id?e("div",[e("van-field",{attrs:{name:"audioUploader"+i.id,required:"T"===i.not_skip_flag,rules:[{required:"T"===i.not_skip_flag,message:"请上传"}]},scopedSlots:t._u([{key:"input",fn:function(){return[e("custom-file-upload",{attrs:{accept:".mp3",name:"audio"},model:{value:t.ticketData[i.id],callback:function(e){t.$set(t.ticketData,i.id,e)},expression:"ticketData[item.id]"}})]},proxy:!0}],null,!0)})],1):t._e(),"datetime"===i.options_id||"date"===i.options_id?e("div",[e("van-field",{attrs:{readonly:"",clickable:"",name:t.ticketData[i.id],value:t.ticketData[i.id],required:"T"===i.not_skip_flag,placeholder:"点击选择时间",rules:[{required:"T"===i.not_skip_flag,message:"请选择"}]},on:{click:function(e){return t.showDatePicker(i)}}}),e("van-popup",{attrs:{position:"bottom"},model:{value:t.showPicker[i.id],callback:function(e){t.$set(t.showPicker,i.id,e)},expression:"showPicker[item.id]"}},[e("van-datetime-picker",{attrs:{type:i.options_id,"min-date":t.minDate,"max-date":t.maxDate},on:{confirm:function(e){return t.onConfirm(e,i)},cancel:function(e){return t.cancelDatePicker(i)}}})],1)],1):t._e()],1)})),e("div",{staticStyle:{margin:"16px"}},[e("van-button",{attrs:{round:"",block:"",type:"info","native-type":"submit"}},[t._v("提交")])],1)],2)],1)},s=[],o=i(2136),n={name:"TicketTaskDispose",components:{CustomFileUpload:o.A},data(){return{id:"",templateId:"",ticketData:{},list:[],showPicker:{},minDate:this.$date().toDate(),maxDate:this.$date().add(1,"month").toDate()}},mounted(){this.templateId=this.$route.query.templateId,this.id=this.$route.query.id,this.getListTemplate()},methods:{async getListTemplate(){this.list=await this.$post("/task/ticket/list-template",{templateId:this.templateId}),this.list&&this.list.length>0?this.list.forEach((t=>{if(t.options_config)try{t.list_options=JSON.parse(t.options_config)}catch(e){console.log(e)}"checkbox"===t.options_id&&this.$set(this.ticketData,t.id,[]),"datetime"===t.options_id||t.options_id})):this.list=[]},async onSubmit(t){const e=await this.$dialog.confirm({title:"提示",message:"是否确认保存？"}).catch((()=>{}));if(!e)return;const i=Object.assign({},this.ticketData);Object.keys(i).forEach((t=>{this.list.forEach((e=>{parseInt(t)!==parseInt(e.id)||"image"!==e.options_id&&"attachs"!==e.options_id&&"audio"!==e.options_id||(i[t]=i[t].map((t=>!!t.url&&t.url.replace(this.$api.baseImage,""))))}))})),i.id=this.id,await this.$post("/task/ticket/update",i),this.$toast("提交成功"),await this.$utils.closePage(!0)},onConfirm(t,e){let i=this.$date(t).format("YYYY-MM-DD HH:mm:ss");"date"===e.options_id&&(i=this.$date(t).format("YYYY-MM-DD")),this.$set(this.ticketData,e.id,i),this.cancelDatePicker(e)},validFailed(t){t.errors.length>0&&this.$toast(t.errors[0].message)},showDatePicker(t){this.$set(this.showPicker,t.id,!0)},cancelDatePicker(t){this.$set(this.showPicker,t.id,!1)}}},r=n,l=i(845),c=(0,l.A)(r,a,s,!1,null,"0c2a7718",null),d=c.exports}}]);
//# sourceMappingURL=644.d931b39c.js.map