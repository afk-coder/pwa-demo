{"version":3,"file":"js/59.f7e46fb1.js","mappings":"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","sources":["webpack://sl-device-vue/./src/views/ticket/qc/step_info.vue","webpack://sl-device-vue/src/views/ticket/qc/step_info.vue","webpack://sl-device-vue/./src/views/ticket/qc/step_info.vue?5730","webpack://sl-device-vue/./src/views/ticket/qc/step_info.vue?7419"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"app-container\"},[_c('van-form',{on:{\"submit\":_vm.onSubmit}},[_c('van-field',{attrs:{\"label\":\"工单步骤\",\"readonly\":\"\"},model:{value:(_vm.step.name),callback:function ($$v) {_vm.$set(_vm.step, \"name\", $$v)},expression:\"step.name\"}}),_c('van-field',{attrs:{\"type\":\"digit\",\"required\":\"\",\"label\":\"本次得分\",\"readonly\":_vm.isReadonly},model:{value:(_vm.point),callback:function ($$v) {_vm.point=$$v},expression:\"point\"}}),(!_vm.isReadonly)?_c('van-field',{attrs:{\"readonly\":\"\",\"clickable\":\"\",\"label\":\"保洁质量\",\"value\":_vm.value,\"placeholder\":\"请选择\"},on:{\"click\":function($event){_vm.showPicker = true}}}):_vm._e(),_c('van-popup',{attrs:{\"round\":\"\",\"position\":\"bottom\"},model:{value:(_vm.showPicker),callback:function ($$v) {_vm.showPicker=$$v},expression:\"showPicker\"}},[_c('van-picker',{attrs:{\"show-toolbar\":\"\",\"columns\":_vm.columns},on:{\"cancel\":function($event){_vm.showPicker = false},\"confirm\":_vm.onConfirm}})],1),_c('van-field',{attrs:{\"rows\":\"5\",\"autosize\":\"\",\"required\":_vm.report_flag === '1',\"label\":\"质控报告\",\"type\":\"textarea\",\"maxlength\":\"200\",\"placeholder\":\"请填写质控报告\",\"show-word-limit\":\"\",\"readonly\":_vm.isReadonly},model:{value:(_vm.note),callback:function ($$v) {_vm.note=$$v},expression:\"note\"}}),_c('van-cell',{attrs:{\"title\":_vm.isReadonly?'图片列表':'上传图片',\"value\":\"\"}}),_c('van-uploader',{staticStyle:{\"float\":\"left\"},attrs:{\"multiple\":\"\",\"max-count\":5,\"after-read\":_vm.afterRead,\"max-size\":1024 * 1024,\"deletable\":!_vm.isReadonly,\"show-upload\":false},on:{\"oversize\":_vm.onOversize},model:{value:(_vm.fileList),callback:function ($$v) {_vm.fileList=$$v},expression:\"fileList\"}}),(!_vm.isReadonly)?_c('div',{staticClass:\"van-uploader__upload van-uploader__upload--readonly\",staticStyle:{\"float\":\"left\"},on:{\"click\":function($event){return _vm.chooseImage({val:0})}}},[_c('i',{staticClass:\"van-icon van-icon-photograph van-uploader__upload-icon\"})]):_vm._e(),(!_vm.isReadonly)?_c('div',{staticStyle:{\"margin\":\"30px\"}},[_c('van-button',{attrs:{\"round\":\"\",\"block\":\"\",\"type\":\"info\",\"icon\":\"checked\",\"native-type\":\"submit\"}},[_vm._v(\"保存\")])],1):_vm._e(),(_vm.isReadonly && _vm.fileList.length === 0)?_c('van-empty',{attrs:{\"description\":\"暂无图片\"}}):_vm._e()],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"app-container\">\r\n    <van-form @submit=\"onSubmit\">\r\n      <van-field v-model=\"step.name\" label=\"工单步骤\" readonly />\r\n      <van-field v-model=\"point\" type=\"digit\" required label=\"本次得分\" :readonly=\"isReadonly\" />\r\n      <van-field\r\n        v-if=\"!isReadonly\"\r\n        readonly\r\n        clickable\r\n        label=\"保洁质量\"\r\n        :value=\"value\"\r\n        placeholder=\"请选择\"\r\n        @click=\"showPicker = true\"\r\n      />\r\n      <van-popup v-model=\"showPicker\" round position=\"bottom\">\r\n        <van-picker\r\n          show-toolbar\r\n          :columns=\"columns\"\r\n          @cancel=\"showPicker = false\"\r\n          @confirm=\"onConfirm\"\r\n        />\r\n      </van-popup>\r\n      <van-field\r\n        v-model=\"note\"\r\n        rows=\"5\"\r\n        autosize\r\n        :required=\"report_flag === '1'\"\r\n        label=\"质控报告\"\r\n        type=\"textarea\"\r\n        maxlength=\"200\"\r\n        placeholder=\"请填写质控报告\"\r\n        show-word-limit\r\n        :readonly=\"isReadonly\"\r\n      />\r\n      <van-cell :title=\"isReadonly?'图片列表':'上传图片'\" value=\"\" />\r\n\r\n      <!--电脑选择图片-->\r\n      <!--      <van-uploader v-model=\"fileList\" multiple :max-count=\"5\" :after-read=\"afterRead\" :max-size=\"1024 * 1024\" :deletable=\"!isReadonly\" :show-upload=\"!isReadonly\" style=\"float: left;\" @oversize=\"onOversize\" />-->\r\n\r\n      <!--真机拍照-->\r\n      <van-uploader v-model=\"fileList\" multiple :max-count=\"5\" :after-read=\"afterRead\" :max-size=\"1024 * 1024\" :deletable=\"!isReadonly\" :show-upload=\"false\" style=\"float: left;\" @oversize=\"onOversize\" />\r\n      <div v-if=\"!isReadonly\" class=\"van-uploader__upload van-uploader__upload--readonly\" style=\"float:left;\" @click=\"chooseImage({val:0})\">\r\n        <i class=\"van-icon van-icon-photograph van-uploader__upload-icon\" />\r\n      </div>\r\n\r\n      <div v-if=\"!isReadonly\" style=\"margin: 30px;\">\r\n        <van-button round block type=\"info\" icon=\"checked\" native-type=\"submit\">保存</van-button>\r\n      </div>\r\n\r\n      <van-empty v-if=\"isReadonly && fileList.length === 0\" description=\"暂无图片\" />\r\n    </van-form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'QcStepInfo',\r\n  data() {\r\n    return {\r\n      step_id: '',\r\n      report_flag: null, // 质控报告：1 需要填写 0 不需要\r\n      step: [],\r\n      point: '',\r\n\r\n      value: '',\r\n      showPicker: false,\r\n      columns: ['地面有灰尘', '地面有积水', '被褥床单不整洁', '垃圾未清理', '符合标准', '合格'],\r\n\r\n      note: '',\r\n      isReadonly: false, // 是否只读\r\n      fileList: [],\r\n      show: false\r\n    }\r\n  },\r\n  async mounted() {\r\n    this.step_id = this.$route.query.step_id\r\n    this.report_flag = this.$route.query.report_flag\r\n    this.step = await this.$http.post('/work-ticket/qc_step/get', { step_id: this.step_id })\r\n\r\n    if (this.step.state === 1) { // 已签到\r\n      this.isReadonly = true\r\n      this.point = this.step.point\r\n      this.note = this.step.note\r\n      if (!this.note) this.note = '暂无'\r\n      if (this.step.imagelist && this.step.imagelist.length > 0) {\r\n        const imageArr = []\r\n        this.step.imagelist.forEach(item => {\r\n          imageArr.push({ url: item, isImage: true })\r\n        })\r\n        this.fileList = imageArr\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    onConfirm(value) {\r\n      this.value = value\r\n      if (this.note) {\r\n        this.note = this.note + ',' + value\r\n      } else {\r\n        this.note = value\r\n      }\r\n      this.showPicker = false\r\n    },\r\n    afterRead(file) {\r\n      // 此时可以自行将文件上传至服务器\r\n    },\r\n    onOversize(file) {\r\n      this.$toast('文件大小不能超过 1024kb')\r\n    },\r\n    chooseImage(item) {\r\n      // 默认情况下点击选项时不会自动收起\r\n      // 可以通过 close-on-click-action 属性开启自动收起\r\n      this.show = false\r\n      this.$bridge.CollectPhoto(item.val).then(res => {\r\n        if (!res) {\r\n          this.$toast('未选择图片')\r\n        } else {\r\n          const base64 = 'data:image/png;base64,' + res\r\n          this.fileList.push({ content: base64, url: base64, isImage: true })\r\n        }\r\n      })\r\n    },\r\n    async onSubmit() {\r\n      if (!(this.point + '')) {\r\n        this.$toast('分数不能为空')\r\n        return\r\n      }\r\n      if (this.report_flag === '1' && !this.note) {\r\n        this.$toast('质控报告不能为空')\r\n        return\r\n      }\r\n\r\n      const confirm = await this.$dialog.confirm({\r\n        title: '标题',\r\n        message: '是否确认保存？'\r\n      }).catch(() => {})\r\n      if (!confirm) return\r\n\r\n      const fileArr = []\r\n      if (this.fileList && this.fileList.length > 0) {\r\n        // eslint-disable-next-line array-callback-return\r\n        this.fileList.map(item => {\r\n          if (item && item.content) {\r\n            fileArr.push(item.content.substring(item.content.indexOf(',') + 1))\r\n          }\r\n        })\r\n      }\r\n      await this.$http.post('/work-ticket/qc_step/sign-in', { step_id: this.step_id, point: this.point, note: this.note, file_list: fileArr })\r\n      await this.$toast.success('操作成功！')\r\n      // await this.$bridge.Close(true)\r\n      await this.$router.back()\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.app-container {\r\n  width: 100%;\r\n  height: 100%;\r\n  overflow: auto;\r\n  background-color: #fff;\r\n  color: rgb(153, 153, 153);\r\n  p {\r\n    margin: 0 0 5px 0;\r\n  }\r\n  .row{\r\n    display: flex;\r\n    justify-content: space-between;\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./step_info.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./step_info.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./step_info.vue?vue&type=template&id=1fc51cce&scoped=true\"\nimport script from \"./step_info.vue?vue&type=script&lang=js\"\nexport * from \"./step_info.vue?vue&type=script&lang=js\"\nimport style0 from \"./step_info.vue?vue&type=style&index=0&id=1fc51cce&prod&lang=less&scoped=true\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"1fc51cce\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","on","onSubmit","attrs","model","value","step","name","callback","$$v","$set","expression","isReadonly","point","_e","$event","showPicker","columns","onConfirm","report_flag","note","staticStyle","afterRead","onOversize","fileList","chooseImage","val","_v","length","staticRenderFns","data","step_id","show","mounted","$route","query","$http","post","state","imagelist","imageArr","forEach","item","push","url","isImage","methods","file","$toast","$bridge","CollectPhoto","then","res","base64","content","confirm","$dialog","title","message","catch","fileArr","map","substring","indexOf","file_list","success","$router","back","component"],"sourceRoot":""}